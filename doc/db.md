---
aliases:
  - db
  - database
tags: 
cssclasses:
---
###### Area links
- [[README|Main doc]]
- [[doc/Architecture|Architecture]]
##### work notes

_______________________________
# db

База данных MySQL, запущенная в контейнере, будет хранить свои таблицы и данные внутри контейнера. Когда контейнер с базой запускается, он создает том для хранения данных по умолчанию. Это означает, что данные, созданные и измененные в базе данных MySQL, будут сохраняться внутри этого тома, который является частью контейнера.

При остановке, перезапуске и удалении контейнера все его данные обнуляются/удаляются (действительно ли?)

## Dockerfile

Собственно ничего суперинтересного пока нет, стандартный Dockerfile, всё понятно из комментариев. Неиспользуемые части, мешающие тестовой сборке контейнера тоже закомментированы. 

```dockerfile
# Используем официальный образ MySQL
FROM mysql:latest

# Указываем переменные окружения для настройки базы данных
ENV MYSQL_ROOT_PASSWORD=root_password
ENV MYSQL_DATABASE=my_database
ENV MYSQL_USER=my_user
ENV MYSQL_PASSWORD=my_password

# Копируем SQL-скрипты и конфигурационные файлы в контейнер
# COPY init.sql /docker-entrypoint-initdb.d/
# COPY my.cnf /etc/mysql/my.cnf

# Определяем порт, который будет использоваться для подключения к базе данных
EXPOSE 3306
```
## Что делает compose.yaml для базы

Чтобы обеспечить сохранность данных при перезапуске или удалении контейнера, используем том Docker для хранения данных (файлов, в которых MySQL хранит таблицы и прочую инфу) базы данных. Это делается с помощью определения томов в файле docker-compose.yml следующим образом:
```yaml
version: '3'
services:
  db:
    build:
      context: ./db
      dockerfile: Dockerfile
    volumes:
      - mysql-data:/var/lib/mysql
    ports:
      - "3306:3306"
  app:
    build:
      context: ./app
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    depends_on:
      - db
volumes:
  mysql-data:./db-data
```
Где опция `volumes` внутри определения сервиса `db` подключает том `mysql-data` к директории `/var/lib/mysql` внутри контейнера, где база MySQL хранит свои данные. А блок `volumes` в самом конце служит для определения томa volumes и после двоеточия нужно указывать путь к локальной директории, которая и будет определена как том docker c соответствующим именем, в данном случае `mysql-data`

